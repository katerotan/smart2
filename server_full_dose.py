from flask import Flask, request, jsonify
import os

app = Flask(__name__)

@app.route('/process_data', methods=['POST'])
def process_data():
    try:
        data = request.json
        if not data or 'weight_kg' not in data:
            return jsonify({"error": "No data provided or 'weight_kg' not found"}), 400

        weight_kg = data['weight_kg']

        # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–∏–ø—É –¥–∞–Ω–∏—Ö
        if isinstance(weight_kg, str):
            try:
                weight_kg = float(weight_kg)
            except ValueError:
                return jsonify({"error": "Weight must be a number"}), 400

        if not isinstance(weight_kg, (int, float)):
            return jsonify({"error": "Weight must be a number"}), 400

        # –§–æ—Ä–º—É–ª–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –¥–æ–∑—É–≤–∞–Ω–Ω—è –∑ –æ–∫—Ä—É–≥–ª–µ–Ω–Ω—è–º –¥–æ –¥–µ—Å—è—Ç–∏—Ö
        augmentin_es_dose = round(((90 * weight_kg) / 2) / 120, 1)
        augmentin_400_70_dose = round(((70 * weight_kg) / 2) / 80, 1)
        augmentin_400_45_dose = round(((45 * weight_kg) / 2) / 80, 1)
        augmentin_200_70_dose = round(((70 * weight_kg) / 2) / 40, 1)
        augmentin_200_45_dose = round(((45 * weight_kg) / 2) / 40, 1)

        # –§–æ—Ä–º—É–≤–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ç–∏–ø—É –ø—Ä–µ–ø–∞—Ä–∞—Ç—É
        if weight_kg <= 45:
            message_es = (
                f"<b>–ê—É–≥–º–µ–Ω—Ç–∏–Ω ES</b><br>"
                f"600 –º–≥ / 5 –º–ª + 42,9 / 5 –º–ª<br>"
                f"—Ñ–ª. 100 –º–ª. ‚Ññ 1<br>"
                f"üî∏üî∏üî∏<br>"
                f"üëßüë¶–î–ª—è –¥—ñ—Ç–µ–π –≤–∞–≥–æ—é <b>{weight_kg}</b> –∫–≥<br>"
                f"c–ª—ñ–¥ –ø—Ä–∏–∑–Ω–∞—á–∏—Ç–∏ –ø–æ <b>{augmentin_es_dose}</b> –º–ª<br>"
                f"ü•õ 2 —Ä–∞–∑–∏ –Ω–∞ –¥–æ–±—É<br>"
                f"üî∏üî∏üî∏<br>"
                f"–î–ª—è –±—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó —Ä–æ–∑–≥–ª—è–Ω—å—Ç–µ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—éüîéüìò"
            )
            message_400 = (
                f"<b>–ê—É–≥–º–µ–Ω—Ç–∏–Ω 400 –º–≥</b><br>"
                f"400 –º–≥ / 5 –º–ª + 57 –º–≥ / 5 –º–ª<br>"
                f"—Ñ–ª. –¥–ª—è –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è 70 –º–ª —Å—É—Å–ø. ‚Ññ 1<br>"
                f"üî∏üî∏üî∏<br>"
                f"üëßüë¶–î–ª—è –¥—ñ—Ç–µ–π –≤–∞–≥–æ—é <b>{weight_kg}</b> –∫–≥<br>"
                f"–ü—Ä–∏ –¥–æ–∑—É–≤–∞–Ω–Ω—ñ 45 –º–≥/–∫–≥: <b>{augmentin_400_45_dose}</b> –º–ª<br>"
                f"–ü—Ä–∏ –¥–æ–∑—É–≤–∞–Ω–Ω—ñ 70 –º–≥/–∫–≥: <b>{augmentin_400_70_dose}</b> –º–ª<br>"
                f"ü•õ 2 —Ä–∞–∑–∏ –Ω–∞ –¥–æ–±—É<br>"
                f"üî∏üî∏üî∏<br>"
                f"–î–ª—è –±—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó —Ä–æ–∑–≥–ª—è–Ω—å—Ç–µ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—éüîéüìò"
            )
            message_200 = (
                f"<b>–ê—É–≥–º–µ–Ω—Ç–∏–Ω 200 –º–≥</b><br>"
                f"200 –º–≥ / 5 –º–ª + 28,5 –º–≥ / 5 –º–ª<br>"
                f"—Ñ–ª. –¥–ª—è –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è 70 –º–ª —Å—É—Å–ø. ‚Ññ 1<br>"
                f"üî∏üî∏üî∏<br>"
                f"üëßüë¶–î–ª—è –¥—ñ—Ç–µ–π –≤–∞–≥–æ—é <b>{weight_kg}</b> –∫–≥<br>"
                f"–ü—Ä–∏ –¥–æ–∑—É–≤–∞–Ω–Ω—ñ 45 –º–≥/–∫–≥: <b>{augmentin_200_45_dose}</b> –º–ª<br>"
                f"–ü—Ä–∏ –¥–æ–∑—É–≤–∞–Ω–Ω—ñ 70 –º–≥/–∫–≥: <b>{augmentin_200_70_dose}</b> –º–ª<br>"
                f"ü•õ 2 —Ä–∞–∑–∏ –Ω–∞ –¥–æ–±—É<br>"
                f"üî∏üî∏üî∏<br>"
                f"–î–ª—è –±—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó —Ä–æ–∑–≥–ª—è–Ω—å—Ç–µ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—éüîéüìò"
            )
        else:
            message_es = "–î–ª—è –≤–∞–≥–∏ –±—ñ–ª—å—à–µ 45 –∫–≥ —ñ—Å–Ω—É—î —ñ–Ω—à–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –¥–ª—è –ê—É–≥–º–µ–Ω—Ç–∏–Ω—É ES. –ë—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –≤ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó."
            message_400 = "–î–ª—è –≤–∞–≥–∏ –±—ñ–ª—å—à–µ 45 –∫–≥ —ñ—Å–Ω—É—î —ñ–Ω—à–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –¥–ª—è –ê—É–≥–º–µ–Ω—Ç–∏–Ω—É 400 –º–≥. –ë—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –≤ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó."
            message_200 = "–î–ª—è –≤–∞–≥–∏ –±—ñ–ª—å—à–µ 45 –∫–≥ —ñ—Å–Ω—É—î —ñ–Ω—à–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –¥–ª—è –ê—É–≥–º–µ–Ω—Ç–∏–Ω—É 200 –º–≥. –ë—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –≤ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó."

        # –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –∑ —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–∏–º–∏ –¥–æ–∑–∞–º–∏ —Ç–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏
        response = {
            "augmentin_es_dose": augmentin_es_dose,
            "augmentin_400_70_dose": augmentin_400_70_dose,
            "augmentin_400_45_dose": augmentin_400_45_dose,
            "augmentin_200_70_dose": augmentin_200_70_dose,
            "augmentin_200_45_dose": augmentin_200_45_dose,
            "message_es": message_es,
            "message_400": message_400,
            "message_200": message_200
        }

        return jsonify(response), 200

    except Exception as e:
        return jsonify({"error": str(e)}), 500

if __name__ == "__main__":
    port = int(os.environ.get("PORT", 5000))
    app.run(host="0.0.0.0", port=port)
    